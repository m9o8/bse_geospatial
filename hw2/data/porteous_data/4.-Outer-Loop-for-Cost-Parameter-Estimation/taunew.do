clear all
set more off
set mem 500m
set matsize 800

cd "C:/Users/oporteous/Documents/Data/"

insheet using tauest2.csv
rename v1 marketm
rename v2 marketn
rename v3 crop
rename v4 month
rename v5 treq
rename v6 pdatm
rename v7 pdatn

drop if month==.
drop if month<17
drop if pdatm==999
drop if pdatn==999

gen mcode = 0
replace mcode = 110 if marketm == "Gaborone"
replace mcode = 121 if marketm == "Kalemie"
replace mcode = 122 if marketm == "Kamina"
replace mcode = 123 if marketm == "Kolwezi"
replace mcode = 124 if marketm == "Lubumbashi"
replace mcode = 130 if marketm == "Maseru"
replace mcode = 140 if marketm == "Blantyre"
replace mcode = 141 if marketm == "Karonga"
replace mcode = 142 if marketm == "Lilongwe"
replace mcode = 143 if marketm == "Mangochi"
replace mcode = 144 if marketm == "Mzuzu"
replace mcode = 145 if marketm == "Beira"
replace mcode = 146 if marketm == "Chimoio"
replace mcode = 147 if marketm == "Cuamba"
replace mcode = 148 if marketm == "Lichinga"
replace mcode = 149 if marketm == "Maputo"
replace mcode = 150 if marketm == "Maxixe"
replace mcode = 151 if marketm == "Milange"
replace mcode = 152 if marketm == "Nacala"
replace mcode = 153 if marketm == "Nampula"
replace mcode = 154 if marketm == "Pemba"
replace mcode = 155 if marketm == "Quelimane"
replace mcode = 156 if marketm == "Tete"
replace mcode = 157 if marketm == "XaiXai"
replace mcode = 160 if marketm == "KatimaMulilo"
replace mcode = 161 if marketm == "Oshakati"
replace mcode = 162 if marketm == "Swakopmund"
replace mcode = 163 if marketm == "Windhoek"
replace mcode = 165 if marketm == "Mbabane"
replace mcode = 170 if marketm == "Iringa"
replace mcode = 171 if marketm == "Mbeya"
replace mcode = 172 if marketm == "Mtwara"
replace mcode = 173 if marketm == "Songea"
replace mcode = 174 if marketm == "Sumbawanga"
replace mcode = 180 if marketm == "Chipata"
replace mcode = 181 if marketm == "Kabwe"
replace mcode = 182 if marketm == "Kasama"
replace mcode = 183 if marketm == "Kitwe"
replace mcode = 184 if marketm == "Livingstone"
replace mcode = 185 if marketm == "Lusaka"
replace mcode = 186 if marketm == "Mongu"
replace mcode = 187 if marketm == "Solwezi"
replace mcode = 190 if marketm == "Bulawayo"
replace mcode = 191 if marketm == "Harare"
replace mcode = 192 if marketm == "Hwange"
replace mcode = 193 if marketm == "Masvingo"
replace mcode = 194 if marketm == "Mutare"
replace mcode = 200 if marketm == "Luanda"
replace mcode = 201 if marketm == "Bujumbura"
replace mcode = 202 if marketm == "Gitega"
replace mcode = 203 if marketm == "Muyinga"
replace mcode = 210 if marketm == "Bambari"
replace mcode = 211 if marketm == "Bangassou"
replace mcode = 212 if marketm == "Bangui"
replace mcode = 213 if marketm == "Brazzaville"
replace mcode = 214 if marketm == "Impfondo"
replace mcode = 215 if marketm == "PointeNoire"
replace mcode = 220 if marketm == "Bandundu"
replace mcode = 221 if marketm == "Bukavu"
replace mcode = 222 if marketm == "Bunia"
replace mcode = 223 if marketm == "Butembo"
replace mcode = 224 if marketm == "Gbadolite"
replace mcode = 225 if marketm == "Goma"
replace mcode = 226 if marketm == "Isiro"
replace mcode = 227 if marketm == "Kananga"
replace mcode = 228 if marketm == "Kikwit"
replace mcode = 229 if marketm == "Kindu"
replace mcode = 230 if marketm == "Kinshasa"
replace mcode = 231 if marketm == "Kisangani"
replace mcode = 232 if marketm == "Matadi"
replace mcode = 233 if marketm == "Mbandaka"
replace mcode = 234 if marketm == "MbujiMayi"
replace mcode = 235 if marketm == "Tshikapa"
replace mcode = 236 if marketm == "Uvira"
replace mcode = 237 if marketm == "Zongo"
replace mcode = 240 if marketm == "Gode"
replace mcode = 241 if marketm == "Jijiga"
replace mcode = 242 if marketm == "Yabelo"
replace mcode = 243 if marketm == "Eldoret"
replace mcode = 244 if marketm == "Garissa"
replace mcode = 245 if marketm == "Kisumu"
replace mcode = 246 if marketm == "Lodwar"
replace mcode = 247 if marketm == "Mandera"
replace mcode = 248 if marketm == "Mombasa"
replace mcode = 249 if marketm == "Moyale"
replace mcode = 250 if marketm == "Nairobi"
replace mcode = 251 if marketm == "Nakuru"
replace mcode = 252 if marketm == "Wajir"
replace mcode = 260 if marketm == "Butare"
replace mcode = 261 if marketm == "Gisenyi"
replace mcode = 262 if marketm == "Kigali"
replace mcode = 270 if marketm == "Baidoa"
replace mcode = 271 if marketm == "Beledweyne"
replace mcode = 273 if marketm == "Bosaso"
replace mcode = 274 if marketm == "Galkayo"
replace mcode = 275 if marketm == "Garoowe"
replace mcode = 276 if marketm == "Hargeisa"
replace mcode = 277 if marketm == "Kismayo"
replace mcode = 278 if marketm == "Mogadishu"
replace mcode = 279 if marketm == "Juba"
replace mcode = 280 if marketm == "Arusha"
replace mcode = 281 if marketm == "Bukoba"
replace mcode = 282 if marketm == "DaresSalaam"
replace mcode = 283 if marketm == "Dodoma"
replace mcode = 284 if marketm == "Kigoma"
replace mcode = 285 if marketm == "Musoma"
replace mcode = 286 if marketm == "Mwanza"
replace mcode = 287 if marketm == "Singida"
replace mcode = 288 if marketm == "Tabora"
replace mcode = 289 if marketm == "Tanga"
replace mcode = 290 if marketm == "Arua"
replace mcode = 291 if marketm == "Gulu"
replace mcode = 292 if marketm == "Jinja"
replace mcode = 293 if marketm == "Kampala"
replace mcode = 294 if marketm == "Lira"
replace mcode = 295 if marketm == "Masindi"
replace mcode = 296 if marketm == "Mbarara"
replace mcode = 301 if marketm == "Djibouti"
replace mcode = 302 if marketm == "Asmara"
replace mcode = 303 if marketm == "Massawa"
replace mcode = 310 if marketm == "AddisAbaba"
replace mcode = 312 if marketm == "Awasa"
replace mcode = 313 if marketm == "BahirDar"
replace mcode = 314 if marketm == "Dessie"
replace mcode = 315 if marketm == "DireDawa"
replace mcode = 316 if marketm == "Gambela"
replace mcode = 317 if marketm == "Gondar"
replace mcode = 318 if marketm == "Jimma"
replace mcode = 319 if marketm == "Mekele"
replace mcode = 320 if marketm == "Nekemte"
replace mcode = 331 if marketm == "Bor"
replace mcode = 332 if marketm == "Malakal"
replace mcode = 333 if marketm == "Rumbek"
replace mcode = 334 if marketm == "Wau"
replace mcode = 340 if marketm == "AdDamazin"
replace mcode = 341 if marketm == "AlFashir"
replace mcode = 342 if marketm == "AlQadarif"
replace mcode = 343 if marketm == "ElGeneina"
replace mcode = 344 if marketm == "ElObeid"
replace mcode = 345 if marketm == "Kadugli"
replace mcode = 346 if marketm == "Kassala"
replace mcode = 347 if marketm == "Khartoum"
replace mcode = 348 if marketm == "Kosti"
replace mcode = 349 if marketm == "Nyala"
replace mcode = 350 if marketm == "PortSudan"
replace mcode = 401 if marketm == "Cotonou"
replace mcode = 402 if marketm == "Malanville"
replace mcode = 403 if marketm == "Natitingou"
replace mcode = 404 if marketm == "Parakou"
replace mcode = 405 if marketm == "BoboDioulasso"
replace mcode = 406 if marketm == "Dedougou"
replace mcode = 407 if marketm == "FadaNgourma"
replace mcode = 408 if marketm == "Ouagadougou"
replace mcode = 410 if marketm == "Bamenda"
replace mcode = 411 if marketm == "Douala"
replace mcode = 412 if marketm == "Garoua"
replace mcode = 413 if marketm == "Yaounde"
replace mcode = 414 if marketm == "Abeche"
replace mcode = 415 if marketm == "Moundou"
replace mcode = 416 if marketm == "Ndjamena"
replace mcode = 417 if marketm == "Sarh"
replace mcode = 420 if marketm == "Abengourou"
replace mcode = 421 if marketm == "Abidjan"
replace mcode = 422 if marketm == "Bouake"
replace mcode = 423 if marketm == "Daloa"
replace mcode = 424 if marketm == "Man"
replace mcode = 425 if marketm == "Odienne"
replace mcode = 426 if marketm == "Libreville"
replace mcode = 427 if marketm == "Banjul"
replace mcode = 428 if marketm == "Accra"
replace mcode = 429 if marketm == "Bolgatanga"
replace mcode = 430 if marketm == "Ho"
replace mcode = 431 if marketm == "Kumasi"
replace mcode = 432 if marketm == "SekondiTakoradi"
replace mcode = 433 if marketm == "Tamale"
replace mcode = 434 if marketm == "Wa"
replace mcode = 435 if marketm == "Conakry"
replace mcode = 436 if marketm == "Kankan"
replace mcode = 438 if marketm == "Labe"
replace mcode = 439 if marketm == "Nzerekore"
replace mcode = 440 if marketm == "Bissau"
replace mcode = 441 if marketm == "Gbarnga"
replace mcode = 442 if marketm == "Monrovia"
replace mcode = 443 if marketm == "Bamako"
replace mcode = 444 if marketm == "Gao"
replace mcode = 445 if marketm == "Kayes"
replace mcode = 446 if marketm == "Mopti"
replace mcode = 447 if marketm == "Segou"
replace mcode = 448 if marketm == "Sikasso"
replace mcode = 449 if marketm == "AdelBagrou"
replace mcode = 450 if marketm == "Nouakchott"
replace mcode = 451 if marketm == "Tintane"
replace mcode = 452 if marketm == "Agadez"
replace mcode = 453 if marketm == "Arlit"
replace mcode = 454 if marketm == "Diffa"
replace mcode = 455 if marketm == "Maradi"
replace mcode = 456 if marketm == "Niamey"
replace mcode = 457 if marketm == "Tahoua"
replace mcode = 458 if marketm == "Zinder"
replace mcode = 460 if marketm == "Abuja"
replace mcode = 461 if marketm == "Akure"
replace mcode = 462 if marketm == "BeninCity"
replace mcode = 463 if marketm == "Calabar"
replace mcode = 464 if marketm == "Enugu"
replace mcode = 465 if marketm == "Gombe"
replace mcode = 466 if marketm == "Ibadan"
replace mcode = 467 if marketm == "Ilorin"
replace mcode = 468 if marketm == "Jos"
replace mcode = 469 if marketm == "Kaduna"
replace mcode = 470 if marketm == "Kano"
replace mcode = 471 if marketm == "Katsina"
replace mcode = 472 if marketm == "Lagos"
replace mcode = 473 if marketm == "Lokoja"
replace mcode = 474 if marketm == "Maiduguri"
replace mcode = 475 if marketm == "Makurdi"
replace mcode = 476 if marketm == "PortHarcourt"
replace mcode = 477 if marketm == "Sokoto"
replace mcode = 478 if marketm == "Yola"
replace mcode = 480 if marketm == "Dakar"
replace mcode = 481 if marketm == "Kaolack"
replace mcode = 482 if marketm == "SaintLouis"
replace mcode = 483 if marketm == "Tambacounda"
replace mcode = 484 if marketm == "Touba"
replace mcode = 485 if marketm == "Ziguinchor"
replace mcode = 490 if marketm == "Bo"
replace mcode = 491 if marketm == "Freetown"
replace mcode = 492 if marketm == "Kabala"
replace mcode = 493 if marketm == "Kara"
replace mcode = 494 if marketm == "Lome"
replace mcode = 900 if marketm == "Johannesburg"
replace mcode = 920 if marketm == "Gulf"
replace mcode = 940 if marketm == "Bangkok"

gen ncode = 0
replace ncode = 110 if marketn == "Gaborone"
replace ncode = 121 if marketn == "Kalemie"
replace ncode = 122 if marketn == "Kamina"
replace ncode = 123 if marketn == "Kolwezi"
replace ncode = 124 if marketn == "Lubumbashi"
replace ncode = 130 if marketn == "Maseru"
replace ncode = 140 if marketn == "Blantyre"
replace ncode = 141 if marketn == "Karonga"
replace ncode = 142 if marketn == "Lilongwe"
replace ncode = 143 if marketn == "Mangochi"
replace ncode = 144 if marketn == "Mzuzu"
replace ncode = 145 if marketn == "Beira"
replace ncode = 146 if marketn == "Chimoio"
replace ncode = 147 if marketn == "Cuamba"
replace ncode = 148 if marketn == "Lichinga"
replace ncode = 149 if marketn == "Maputo"
replace ncode = 150 if marketn == "Maxixe"
replace ncode = 151 if marketn == "Milange"
replace ncode = 152 if marketn == "Nacala"
replace ncode = 153 if marketn == "Nampula"
replace ncode = 154 if marketn == "Pemba"
replace ncode = 155 if marketn == "Quelimane"
replace ncode = 156 if marketn == "Tete"
replace ncode = 157 if marketn == "XaiXai"
replace ncode = 160 if marketn == "KatimaMulilo"
replace ncode = 161 if marketn == "Oshakati"
replace ncode = 162 if marketn == "Swakopmund"
replace ncode = 163 if marketn == "Windhoek"
replace ncode = 165 if marketn == "Mbabane"
replace ncode = 170 if marketn == "Iringa"
replace ncode = 171 if marketn == "Mbeya"
replace ncode = 172 if marketn == "Mtwara"
replace ncode = 173 if marketn == "Songea"
replace ncode = 174 if marketn == "Sumbawanga"
replace ncode = 180 if marketn == "Chipata"
replace ncode = 181 if marketn == "Kabwe"
replace ncode = 182 if marketn == "Kasama"
replace ncode = 183 if marketn == "Kitwe"
replace ncode = 184 if marketn == "Livingstone"
replace ncode = 185 if marketn == "Lusaka"
replace ncode = 186 if marketn == "Mongu"
replace ncode = 187 if marketn == "Solwezi"
replace ncode = 190 if marketn == "Bulawayo"
replace ncode = 191 if marketn == "Harare"
replace ncode = 192 if marketn == "Hwange"
replace ncode = 193 if marketn == "Masvingo"
replace ncode = 194 if marketn == "Mutare"
replace ncode = 200 if marketn == "Luanda"
replace ncode = 201 if marketn == "Bujumbura"
replace ncode = 202 if marketn == "Gitega"
replace ncode = 203 if marketn == "Muyinga"
replace ncode = 210 if marketn == "Bambari"
replace ncode = 211 if marketn == "Bangassou"
replace ncode = 212 if marketn == "Bangui"
replace ncode = 213 if marketn == "Brazzaville"
replace ncode = 214 if marketn == "Impfondo"
replace ncode = 215 if marketn == "PointeNoire"
replace ncode = 220 if marketn == "Bandundu"
replace ncode = 221 if marketn == "Bukavu"
replace ncode = 222 if marketn == "Bunia"
replace ncode = 223 if marketn == "Butembo"
replace ncode = 224 if marketn == "Gbadolite"
replace ncode = 225 if marketn == "Goma"
replace ncode = 226 if marketn == "Isiro"
replace ncode = 227 if marketn == "Kananga"
replace ncode = 228 if marketn == "Kikwit"
replace ncode = 229 if marketn == "Kindu"
replace ncode = 230 if marketn == "Kinshasa"
replace ncode = 231 if marketn == "Kisangani"
replace ncode = 232 if marketn == "Matadi"
replace ncode = 233 if marketn == "Mbandaka"
replace ncode = 234 if marketn == "MbujiMayi"
replace ncode = 235 if marketn == "Tshikapa"
replace ncode = 236 if marketn == "Uvira"
replace ncode = 237 if marketn == "Zongo"
replace ncode = 240 if marketn == "Gode"
replace ncode = 241 if marketn == "Jijiga"
replace ncode = 242 if marketn == "Yabelo"
replace ncode = 243 if marketn == "Eldoret"
replace ncode = 244 if marketn == "Garissa"
replace ncode = 245 if marketn == "Kisumu"
replace ncode = 246 if marketn == "Lodwar"
replace ncode = 247 if marketn == "Mandera"
replace ncode = 248 if marketn == "Mombasa"
replace ncode = 249 if marketn == "Moyale"
replace ncode = 250 if marketn == "Nairobi"
replace ncode = 251 if marketn == "Nakuru"
replace ncode = 252 if marketn == "Wajir"
replace ncode = 260 if marketn == "Butare"
replace ncode = 261 if marketn == "Gisenyi"
replace ncode = 262 if marketn == "Kigali"
replace ncode = 270 if marketn == "Baidoa"
replace ncode = 271 if marketn == "Beledweyne"
replace ncode = 273 if marketn == "Bosaso"
replace ncode = 274 if marketn == "Galkayo"
replace ncode = 275 if marketn == "Garoowe"
replace ncode = 276 if marketn == "Hargeisa"
replace ncode = 277 if marketn == "Kismayo"
replace ncode = 278 if marketn == "Mogadishu"
replace ncode = 279 if marketn == "Juba"
replace ncode = 280 if marketn == "Arusha"
replace ncode = 281 if marketn == "Bukoba"
replace ncode = 282 if marketn == "DaresSalaam"
replace ncode = 283 if marketn == "Dodoma"
replace ncode = 284 if marketn == "Kigoma"
replace ncode = 285 if marketn == "Musoma"
replace ncode = 286 if marketn == "Mwanza"
replace ncode = 287 if marketn == "Singida"
replace ncode = 288 if marketn == "Tabora"
replace ncode = 289 if marketn == "Tanga"
replace ncode = 290 if marketn == "Arua"
replace ncode = 291 if marketn == "Gulu"
replace ncode = 292 if marketn == "Jinja"
replace ncode = 293 if marketn == "Kampala"
replace ncode = 294 if marketn == "Lira"
replace ncode = 295 if marketn == "Masindi"
replace ncode = 296 if marketn == "Mbarara"
replace ncode = 301 if marketn == "Djibouti"
replace ncode = 302 if marketn == "Asmara"
replace ncode = 303 if marketn == "Massawa"
replace ncode = 310 if marketn == "AddisAbaba"
replace ncode = 312 if marketn == "Awasa"
replace ncode = 313 if marketn == "BahirDar"
replace ncode = 314 if marketn == "Dessie"
replace ncode = 315 if marketn == "DireDawa"
replace ncode = 316 if marketn == "Gambela"
replace ncode = 317 if marketn == "Gondar"
replace ncode = 318 if marketn == "Jimma"
replace ncode = 319 if marketn == "Mekele"
replace ncode = 320 if marketn == "Nekemte"
replace ncode = 331 if marketn == "Bor"
replace ncode = 332 if marketn == "Malakal"
replace ncode = 333 if marketn == "Rumbek"
replace ncode = 334 if marketn == "Wau"
replace ncode = 340 if marketn == "AdDamazin"
replace ncode = 341 if marketn == "AlFashir"
replace ncode = 342 if marketn == "AlQadarif"
replace ncode = 343 if marketn == "ElGeneina"
replace ncode = 344 if marketn == "ElObeid"
replace ncode = 345 if marketn == "Kadugli"
replace ncode = 346 if marketn == "Kassala"
replace ncode = 347 if marketn == "Khartoum"
replace ncode = 348 if marketn == "Kosti"
replace ncode = 349 if marketn == "Nyala"
replace ncode = 350 if marketn == "PortSudan"
replace ncode = 401 if marketn == "Cotonou"
replace ncode = 402 if marketn == "Malanville"
replace ncode = 403 if marketn == "Natitingou"
replace ncode = 404 if marketn == "Parakou"
replace ncode = 405 if marketn == "BoboDioulasso"
replace ncode = 406 if marketn == "Dedougou"
replace ncode = 407 if marketn == "FadaNgourma"
replace ncode = 408 if marketn == "Ouagadougou"
replace ncode = 410 if marketn == "Bamenda"
replace ncode = 411 if marketn == "Douala"
replace ncode = 412 if marketn == "Garoua"
replace ncode = 413 if marketn == "Yaounde"
replace ncode = 414 if marketn == "Abeche"
replace ncode = 415 if marketn == "Moundou"
replace ncode = 416 if marketn == "Ndjamena"
replace ncode = 417 if marketn == "Sarh"
replace ncode = 420 if marketn == "Abengourou"
replace ncode = 421 if marketn == "Abidjan"
replace ncode = 422 if marketn == "Bouake"
replace ncode = 423 if marketn == "Daloa"
replace ncode = 424 if marketn == "Man"
replace ncode = 425 if marketn == "Odienne"
replace ncode = 426 if marketn == "Libreville"
replace ncode = 427 if marketn == "Banjul"
replace ncode = 428 if marketn == "Accra"
replace ncode = 429 if marketn == "Bolgatanga"
replace ncode = 430 if marketn == "Ho"
replace ncode = 431 if marketn == "Kumasi"
replace ncode = 432 if marketn == "SekondiTakoradi"
replace ncode = 433 if marketn == "Tamale"
replace ncode = 434 if marketn == "Wa"
replace ncode = 435 if marketn == "Conakry"
replace ncode = 436 if marketn == "Kankan"
replace ncode = 438 if marketn == "Labe"
replace ncode = 439 if marketn == "Nzerekore"
replace ncode = 440 if marketn == "Bissau"
replace ncode = 441 if marketn == "Gbarnga"
replace ncode = 442 if marketn == "Monrovia"
replace ncode = 443 if marketn == "Bamako"
replace ncode = 444 if marketn == "Gao"
replace ncode = 445 if marketn == "Kayes"
replace ncode = 446 if marketn == "Mopti"
replace ncode = 447 if marketn == "Segou"
replace ncode = 448 if marketn == "Sikasso"
replace ncode = 449 if marketn == "AdelBagrou"
replace ncode = 450 if marketn == "Nouakchott"
replace ncode = 451 if marketn == "Tintane"
replace ncode = 452 if marketn == "Agadez"
replace ncode = 453 if marketn == "Arlit"
replace ncode = 454 if marketn == "Diffa"
replace ncode = 455 if marketn == "Maradi"
replace ncode = 456 if marketn == "Niamey"
replace ncode = 457 if marketn == "Tahoua"
replace ncode = 458 if marketn == "Zinder"
replace ncode = 460 if marketn == "Abuja"
replace ncode = 461 if marketn == "Akure"
replace ncode = 462 if marketn == "BeninCity"
replace ncode = 463 if marketn == "Calabar"
replace ncode = 464 if marketn == "Enugu"
replace ncode = 465 if marketn == "Gombe"
replace ncode = 466 if marketn == "Ibadan"
replace ncode = 467 if marketn == "Ilorin"
replace ncode = 468 if marketn == "Jos"
replace ncode = 469 if marketn == "Kaduna"
replace ncode = 470 if marketn == "Kano"
replace ncode = 471 if marketn == "Katsina"
replace ncode = 472 if marketn == "Lagos"
replace ncode = 473 if marketn == "Lokoja"
replace ncode = 474 if marketn == "Maiduguri"
replace ncode = 475 if marketn == "Makurdi"
replace ncode = 476 if marketn == "PortHarcourt"
replace ncode = 477 if marketn == "Sokoto"
replace ncode = 478 if marketn == "Yola"
replace ncode = 480 if marketn == "Dakar"
replace ncode = 481 if marketn == "Kaolack"
replace ncode = 482 if marketn == "SaintLouis"
replace ncode = 483 if marketn == "Tambacounda"
replace ncode = 484 if marketn == "Touba"
replace ncode = 485 if marketn == "Ziguinchor"
replace ncode = 490 if marketn == "Bo"
replace ncode = 491 if marketn == "Freetown"
replace ncode = 492 if marketn == "Kabala"
replace ncode = 493 if marketn == "Kara"
replace ncode = 494 if marketn == "Lome"
replace ncode = 900 if marketn == "Johannesburg"
replace ncode = 920 if marketn == "Gulf"
replace ncode = 940 if marketn == "Bangkok"

gen pdiff = pdatn - pdatm
gen pdiffabs = abs(pdiff)

gen mincode = 0
replace mincode = mcode if mcode<ncode
replace mincode = ncode if ncode<mcode
gen maxcode = 0
replace maxcode = mcode if mcode>ncode
replace maxcode = ncode if ncode>mcode

gen mncode = mincode*1000 + maxcode

sort mncode
by mncode: egen observ = count(treq>0)
drop if observ==1

tabulate mncode, gen(pair)
scalar numpair = r(r)

preserve
contract mncode mincode maxcode
mkmat mncode mincode maxcode, matrix(codes)
restore

matrix tauhat = J(`=scalar(numpair)',6,.)
forvalues i = 1(1)`=scalar(numpair)'{
preserve
gen keepme = 0
replace keepme = 1 if pair`i'==1
drop if keepme == 0
*reg pdiffabs
reg pdiffabs, vce(bootstrap, reps(10000) seed(4926522))
matrix bet = e(b)
matrix vet = e(V)
scalar net = e(N)
matrix tauhat[`i',1] = codes[`i',1]
matrix tauhat[`i',2] = codes[`i',2]
matrix tauhat[`i',3] = codes[`i',3]
matrix tauhat[`i',4] = bet[1,1]
matrix tauhat[`i',5] = vet[1,1]^0.5
matrix tauhat[`i',6] = net
restore
}

clear

matrix colnames tauhat = mncode mincode maxcode taubar tauSE obs

svmat tauhat, names(col)

save tauBS10000, replace
